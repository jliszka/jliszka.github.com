
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>More backwards functions: Unevaluating polynomials</title>
    <meta name="description" content="">
    <meta name="author" content="Jason Liszka">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.2.2.2.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/twitter/css/pygment.css" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  </head>

  <body>
    <div class="navbar">
      <div class="navbar-inner">
        <div class="container-narrow">
          <a class="brand" href="/">A Gentleman and a Scala</a>
          <ul class="nav">
            
            
            


  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  



          </ul>
        </div>
      </div>
    </div>

    <div class="container-narrow">

      <div class="content">
        
<div class="page-header">
  <h1>More backwards functions: Unevaluating polynomials </h1>
</div>

<div class="row-fluid post-full">
  <div class="span12">
    <div class="date">
      <span>23 September 2013</span>
    </div>
    <div class="content">
      <p>I have a function that evaluates polynomials with integer coefficients. To evaluate <script type='math/tex; mode=display'>
%<![CDATA[
f(x) = 2x^3 + 5x + 6
%]]>
</script> at <script type='math/tex'>f(8)</script>, for example, you do this:</p>

<pre><code>scala&gt; evalPoly(8, List(6, 5, 0, 2))
res0: (Int, Int) = (8, 1070)</code></pre>

<p>For some reason it echoes the input back out to you. Here&#8217;s the code you might write:</p>
<div class='highlight'><pre><code class='scala'><span class='k'>def</span> <span class='n'>evalPoly</span><span class='o'>(</span><span class='n'>x</span><span class='k'>:</span> <span class='kt'>Int</span><span class='o'>,</span> <span class='n'>coeffs</span><span class='k'>:</span> <span class='kt'>List</span><span class='o'>[</span><span class='kt'>Int</span><span class='o'>])</span><span class='k'>:</span> <span class='o'>(</span><span class='kt'>Int</span><span class='o'>,</span> <span class='kt'>Int</span><span class='o'>)</span> <span class='k'>=</span> <span class='o'>{</span>
  <span class='k'>def</span> <span class='n'>eval</span><span class='o'>(</span><span class='n'>cs</span><span class='k'>:</span> <span class='kt'>List</span><span class='o'>[</span><span class='kt'>Int</span><span class='o'>])</span><span class='k'>:</span> <span class='kt'>Int</span> <span class='o'>=</span> <span class='o'>{</span>
    <span class='n'>cs</span> <span class='k'>match</span> <span class='o'>{</span>
      <span class='k'>case</span> <span class='nc'>Nil</span> <span class='k'>=&gt;</span> <span class='mi'>0</span>
      <span class='k'>case</span> <span class='n'>h</span> <span class='o'>::</span> <span class='n'>t</span> <span class='k'>=&gt;</span> <span class='n'>x</span> <span class='o'>*</span> <span class='n'>eval</span><span class='o'>(</span><span class='n'>t</span><span class='o'>)</span> <span class='o'>+</span> <span class='n'>h</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
  <span class='o'>(</span><span class='n'>x</span><span class='o'>,</span> <span class='n'>eval</span><span class='o'>(</span><span class='n'>coeffs</span><span class='o'>))</span>
<span class='o'>}</span>
</code></pre></div>
<p>This should not be surprising.</p>

<p>But I also have a function that un-evaluates polynomials. To un-evaluate <script type='math/tex'>f(8) = 1070</script>, you do this:</p>

<pre><code>scala&gt; unevalPoly(8, 1070)
res1: (Int, List[Int]) = (8, List(6, 5, 0, 2))</code></pre>

<p>and it echoes your input and gives you back the coefficients of the polynomial.</p>

<p>Wait, what? I thought you needed <script type='math/tex'>N+1</script> points to determine an <script type='math/tex'>N</script>-degree polynomial. Here I&#8217;ve seemingly done it with just one point. To spoil the surprise a little, <code>unevalPoly</code> doesn&#8217;t always work. But how does it work even some of the time? How would you go about coding this up?</p>

<p>Having noticed that the input to <code>unevalPoly</code> is the output of <code>evalPoly</code>, and vice versa, one tack we can try is to write <code>evalPoly</code> backwards. First let me rewrite it slightly:</p>
<div class='highlight'><pre><code class='scala'><span class='k'>def</span> <span class='n'>evalPoly</span><span class='o'>(</span><span class='n'>x</span><span class='k'>:</span> <span class='kt'>Int</span><span class='o'>,</span> <span class='n'>coeffs</span><span class='k'>:</span> <span class='kt'>List</span><span class='o'>[</span><span class='kt'>Int</span><span class='o'>])</span><span class='k'>:</span> <span class='o'>(</span><span class='kt'>Int</span><span class='o'>,</span> <span class='kt'>Int</span><span class='o'>)</span> <span class='k'>=</span> <span class='o'>{</span>
  <span class='k'>def</span> <span class='n'>eval</span><span class='o'>(</span><span class='n'>cs</span><span class='k'>:</span> <span class='kt'>List</span><span class='o'>[</span><span class='kt'>Int</span><span class='o'>])</span><span class='k'>:</span> <span class='kt'>Int</span> <span class='o'>=</span> <span class='o'>{</span>
    <span class='n'>cs</span> <span class='k'>match</span> <span class='o'>{</span>
      <span class='k'>case</span> <span class='nc'>Nil</span> <span class='k'>=&gt;</span> <span class='mi'>0</span>
      <span class='k'>case</span> <span class='n'>h</span> <span class='o'>::</span> <span class='n'>t</span> <span class='k'>=&gt;</span> <span class='n'>plustimes</span><span class='o'>(</span><span class='n'>x</span><span class='o'>,</span> <span class='n'>eval</span><span class='o'>(</span><span class='n'>t</span><span class='o'>),</span> <span class='n'>h</span><span class='o'>)</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
  <span class='o'>(</span><span class='n'>x</span><span class='o'>,</span> <span class='n'>eval</span><span class='o'>(</span><span class='n'>coeffs</span><span class='o'>))</span>
<span class='o'>}</span>
</code></pre></div>
<p>I&#8217;ve just replaced <code>x * eval(t) + h</code> with a call to this function:</p>
<div class='highlight'><pre><code class='scala'><span class='k'>def</span> <span class='n'>plustimes</span><span class='o'>(</span><span class='n'>n</span><span class='k'>:</span> <span class='kt'>Int</span><span class='o'>,</span> <span class='n'>q</span><span class='k'>:</span> <span class='kt'>Int</span><span class='o'>,</span> <span class='n'>r</span><span class='k'>:</span> <span class='kt'>Int</span><span class='o'>)</span> <span class='k'>=</span> <span class='o'>{</span>
  <span class='n'>n</span> <span class='o'>*</span> <span class='n'>q</span> <span class='o'>+</span> <span class='n'>r</span>
<span class='o'>}</span>
</code></pre></div>
<p>Now here&#8217;s <code>eval</code> as a data flow diagram. I&#8217;ve threaded through <code>x</code> as a &#8220;context&#8221; variable because it isn&#8217;t an input to <code>eval</code> per se.</p>

<p><img alt='eval' src='/assets/img/poly/eval.png' /></p>

<p>Following the arrows backwards from the outputs to the inputs we can write the following code:</p>
<div class='highlight'><pre><code class='scala'><span class='k'>def</span> <span class='n'>unevalPoly</span><span class='o'>(</span><span class='n'>x</span><span class='k'>:</span> <span class='kt'>Int</span><span class='o'>,</span> <span class='n'>y</span><span class='k'>:</span> <span class='kt'>Int</span><span class='o'>)</span><span class='k'>:</span> <span class='o'>(</span><span class='kt'>Int</span><span class='o'>,</span> <span class='kt'>List</span><span class='o'>[</span><span class='kt'>Int</span><span class='o'>])</span> <span class='k'>=</span> <span class='o'>{</span>
  <span class='k'>def</span> <span class='n'>uneval</span><span class='o'>(</span><span class='n'>y</span><span class='k'>:</span> <span class='kt'>Int</span><span class='o'>)</span><span class='k'>:</span> <span class='kt'>List</span><span class='o'>[</span><span class='kt'>Int</span><span class='o'>]</span> <span class='k'>=</span> <span class='o'>{</span>
    <span class='n'>y</span> <span class='k'>match</span> <span class='o'>{</span>
      <span class='k'>case</span> <span class='mi'>0</span> <span class='k'>=&gt;</span> <span class='nc'>Nil</span>
      <span class='k'>case</span> <span class='n'>y</span> <span class='k'>=&gt;</span> <span class='o'>{</span>
        <span class='k'>val</span> <span class='o'>(</span><span class='n'>q</span><span class='o'>,</span> <span class='n'>r</span><span class='o'>)</span> <span class='k'>=</span> <span class='n'>unplustimes</span><span class='o'>(</span><span class='n'>x</span><span class='o'>,</span> <span class='n'>y</span><span class='o'>)</span>
        <span class='n'>r</span> <span class='o'>::</span> <span class='n'>uneval</span><span class='o'>(</span><span class='n'>q</span><span class='o'>)</span>
      <span class='o'>}</span>
    <span class='o'>}</span>
  <span class='o'>}</span>
  <span class='o'>(</span><span class='n'>x</span><span class='o'>,</span> <span class='n'>uneval</span><span class='o'>(</span><span class='n'>y</span><span class='o'>))</span>
<span class='o'>}</span>
</code></pre></div>
<p>Now this should work as long as we can write <code>unplustimes</code>, which is possible only when <code>plustimes</code> doesn&#8217;t destroy information. So given <code>m</code> and <code>n</code> and <code>m = n * q + r</code>, when can we recover <code>q</code> and <code>r</code>?</p>

<p>Well, if <code>r</code> happens to be less than <code>n</code>, this is just like doing long division â€” <code>q</code> and <code>r</code> are the quotient and remainder when dividing <code>m</code> by <code>n</code>:</p>
<div class='highlight'><pre><code class='scala'><span class='k'>def</span> <span class='n'>unplustimes</span><span class='o'>(</span><span class='n'>n</span><span class='k'>:</span> <span class='kt'>Int</span><span class='o'>,</span> <span class='n'>m</span><span class='k'>:</span> <span class='kt'>Int</span><span class='o'>)</span><span class='k'>:</span> <span class='o'>(</span><span class='kt'>Int</span><span class='o'>,</span> <span class='kt'>Int</span><span class='o'>)</span> <span class='k'>=</span> <span class='o'>{</span>
  <span class='k'>val</span> <span class='n'>q</span> <span class='k'>=</span> <span class='n'>m</span> <span class='o'>/</span> <span class='n'>n</span>
  <span class='k'>val</span> <span class='n'>r</span> <span class='k'>=</span> <span class='n'>m</span> <span class='o'>%</span> <span class='n'>n</span>
  <span class='o'>(</span><span class='n'>q</span><span class='o'>,</span> <span class='n'>r</span><span class='o'>)</span>
<span class='o'>}</span>
</code></pre></div>
<p>This works because for a given positive integer <script type='math/tex'>n</script>, any integer <script type='math/tex'>m</script> can be written uniquely as <script type='math/tex'>m = nq + r</script>, where <script type='math/tex'>q</script> and <script type='math/tex'>r</script> are nonnegative integers and <script type='math/tex'>r \lt n</script>. Since this formulation is unique, it&#8217;s easy to reverse the process and recover <script type='math/tex'>q</script> and <script type='math/tex'>r</script>.</p>

<p>So what does that mean for <code>unevalPoly</code>? It will only work if</p>

<ol>
<li><code>x</code> is a positive integer, and</li>

<li>all of the coefficients are nonnegative integers less than <code>x</code>.</li>
</ol>

<p>Let&#8217;s try it out. This works:</p>

<pre><code>scala&gt; evalPoly(5, List(1, 4, 2))
res0: (Int, Int) = (5, 71)

scala&gt; unevalPoly(5, 71)
res1: (Int, List[Int]) = (5, List(1, 4, 2))</code></pre>

<p>But this doesn&#8217;t, as expected:</p>

<pre><code>scala&gt; evalPoly(2, List(1, 4, 2))
res2: (Int, Int) = (2, 17)

scala&gt; unevalPoly(2, 17)
res3: (Int, List[Int]) = (2, List(1, 0, 0, 0, 1))</code></pre>

<p>And neither does this:</p>

<pre><code>scala&gt; evalPoly(5, List(1, -2, 1))
res4: (Int, Int) = (5, 16)

scala&gt; unevalPoly(5, 16)
res5: (Int, List[Int]) = (5, List(1, 3))</code></pre>

<p>Neat though!</p>

<p>This all came to me through a puzzle I heard: Your friend has a secret polynomial, which you know has nonnegative integer coefficients. She challenges you to determine the coefficients of the polynomial, offering to evaluate the polynomial for you on any two numbers you choose.</p>

<p>From the above, you know need to evaluate the polynomial at a number that is larger than all of the coefficients. So all that&#8217;s left to the solution is finding some number that satisfies that description.</p>

<p>By the way, you might have noticed that all <code>unevalPoly(n, m)</code> is doing is converting <code>m</code> to its representation in base <code>n</code>. Here it is converting 42 to base 2:</p>

<pre><code>scala&gt; unevalPoly(2, 42)
res6: (Int, List[Int]) = (2,List(0, 1, 0, 1, 0, 1))</code></pre>

<p>And oh, look:</p>

<pre><code>scala&gt; unevalPoly(10, 12345)
res7: (Int, List[Int]) = (10, List(5, 4, 3, 2, 1))</code></pre>

<p>This all makes sense now. The polynomial</p>
<script type='math/tex; mode=display'>
%<![CDATA[
f(x) = ax^4 + bx^3 + cx^2 + dx + e
%]]>
</script>
<p>is what you mean when you write <script type='math/tex'>abcde_x</script>, which is the unique representation of that number in base <script type='math/tex'>x</script> provided that all of the coefficients are less than <script type='math/tex'>x</script>. Recovering the coefficients of <script type='math/tex'>f(x) = y</script> is the same as writing <script type='math/tex'>y</script> in base <script type='math/tex'>x</script>.</p>

<p>So backwards programming is good for something! If this interests you, you should read my <a href=''>last post on backwards sorting algorithms</a>.</p>
    </div>

    

  


  <div style="float: right; margin-top: 5px">
  <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://jliszka.github.io/drafts/more-backwards-functions-unevaluating-polynomials.html" data-text="More backwards functions: Unevaluating polynomials" data-via="jliszka">Tweet</a>
  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
</div>





    

    <hr>
    <div class="navigation">
    
    
      <div style="clear: both"></div>
    </div>
    <hr>
    


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'jliszka'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




  </div>
</div>


      </div>
      <hr>
      <footer>
        <p>&copy; 2013 Jason Liszka
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
      </footer>

    </div>

    


  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-42567355-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>



  </body>
</html>

