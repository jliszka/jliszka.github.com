
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>How traffic actually works</title>
    <meta name="description" content="">
    <meta name="author" content="Jason Liszka">

    <!-- Enable responsive viewport -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le styles -->
    <link href="/assets/themes/twitter/bootstrap/css/bootstrap.2.2.2.min.css" rel="stylesheet">
    <link href="/assets/themes/twitter/css/style.css?body=1&amp;v=2" rel="stylesheet" type="text/css" media="all">
    <link href="/assets/themes/twitter/css/pygment.css" rel="stylesheet" type="text/css" media="all">

    <!-- Le fav and touch icons -->
  <!-- Update these with your own images
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  -->

    <!-- atom & rss feed -->
    <link href="/atom.xml" type="application/atom+xml" rel="alternate" title="Sitewide ATOM Feed">
    <link href="/rss.xml" type="application/rss+xml" rel="alternate" title="Sitewide RSS Feed">
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  </head>

  <body>
    <div class="navbar">
      <div class="navbar-inner">
        <div class="container-narrow">
          <div class="row-fluid">
            <div class="span9 offset1">
              <a class="brand" href="/">A Gentleman and a Scala</a>
              <ul class="nav">
                
                
                


  
    
      
      	
      	<li><a href="/archive.html">Archive</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
      	
      	<li><a href="/tags.html">Tags</a></li>
      	
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  
    
      
    
  



              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="container-narrow">

      <div class="content">
        
<div class="row-fluid">
  <div class="span9 offset1 post-content post-spacer"></div>
</div>
<div class="row-fluid post-full">
  <div class="span9 offset1 post-content">
    <div class="page-header">
      <h1>How traffic actually works </h1>
    </div>
    <div class="date">
      <span>01 October 2013</span>
    </div>
    <div class="content">
      
<p>Every so often <a href="http://www.smartmotorist.com/traffic-and-safety-guideline/traffic-jams.html">this article</a> makes the
rounds and it annoys me. That isn’t how traffic works and the proposed solutions won’t fix anything. Maybe you can
eliminate the annoying stop-and-go, but no one gets home any faster. In fact you can prove that you and everyone behind you
get home strictly later than if you had just gone along with the stop-and-go traffic.</p>

<h3 id="the-facts">The facts</h3>

<p>Here’s how traffic works. First, we know from <a href="http://www.fhwa.dot.gov/publications/research/operations/tft/chap2.pdf">empirical studies</a>
that drivers tend to maintain a minimum following distance, measured in seconds. It varies per driver, but typically
it’s somewhere between 1.5 and 2 seconds. That works out to a maximum theoretical flow rate of between 1,800 and 2,400
vehicles per lane per hour passing by a given point on the highway. Studies of actual highway traffic have measured flow
rates as high as 2,000 vehicles per lane per hour, which works out to a following distance of 1.8 seconds. (I’m just
going to call it 2 seconds for the sake of round numbers.)</p>

<p>The important fact: <strong>there is a limit to the number of cars that can pass by a given point on the highway in a given
amount of time, and that limit is one car every 2 seconds, per lane</strong>. So imagine you are in heavy traffic during
rush hour. There are a certain number of cars in line in front of you. Let’s pick a  point on the road to call the front
of the line — say, the point at which you plan to exit the highway. The line gets shorter by one car every 2 seconds. If
there are 1,000 cars in front of you, it’s going to take a minimum of 2,000 seconds for you to get to the front of the
line. It doesn’t matter whether people are kind and let cars merge in front of them, zipper-style. It doesn’t matter how
much stop-and-go there is. The simple fact is that it takes 2 seconds per car for you to get to the front of the line,
and there are some cars in front of you that have to get there before you do.</p>

<!-- more -->

<h3 id="merging">Merging</h3>

<p>Say there are some cars that are trying to merge into your lane a mile or so in front of you. Every time a car merges
in, that adds 2 seconds to your trip. If one car merges in every 2 seconds, your trip gets longer by 2 seconds every 2
seconds, which means you are not moving (or will soon not be moving).</p>

<p>Leaving space in front of your car for people who are trying to merge won’t solve anything. Let’s say you slow down to
leave some room for an upcoming merge. Now you are 4 seconds behind the car in front of you instead of 2. You’ve just
added 2 seconds to the commute of everyone behind you in line. Now a car merges in front of you. At the next merge, you
have to leave more space. That’s another 2 seconds for everyone behind you. There is no “simple cure” for this!</p>

<p>If <a href="http://www.smartmotorist.com/traffic-and-safety-guideline/traffic-jams.html">anyone tries to tell you</a> that if only
drivers left space in front of them and took turns merging, traffic would flow smoothly, and it’s only because of jerks
that there are any traffic jams at all, just ask them what’s going to happen at the <em>next</em> merge. Where is that extra
space going to come from? You cannot keep 2 seconds back from the car that has just merged in front of you without, um,
<em>slowing down</em>. If the car in front of you is also slowing down for the same reason, you have to slow down even more.
This is basically the definition of a traffic jam.</p>

<p>Zipper merging is only beneficial insofar as it reduces confusion on the road, the way any convention does — like who
gets to go next at a 4-way stop. Confusion leads to delay, delay leads to anger, etc., etc.</p>

<h3 id="bottlenecks">Bottlenecks</h3>

<p>Suppose you’re on a 2-lane (each way) highway and one lane is closed up ahead due to construction. Now the flow rate of
your lane is cut in half (or there are twice as many cars in line in front of you, depending on how you want to look at
it). Road signs commonly ask you to use both lanes up to the point of the bottleneck. That’s reasonable advice, but it’s not
going to get anyone home faster. Remember only so many cars are going to clear the bottleneck per second, no matter what
happens upstream. The only thing this does is shorten the length of the backup on the highway — it’s a 2 mile backup
instead of a 4 mile backup. This is good because it is less likely to affect other traffic by spilling out onto onramps
and surface roads. Also maybe there’s someone on the highway who’s planning to exit 3 miles before the bottleneck. If
the backup is 2 miles instead of 4 miles, that person doesn’t have to wait in traffic.</p>

<p>As an aside, whenever I see a line of cars on the highway (or, for that matter, any line of anythings anywhere), I make
sure I know what it’s for before I get in it. If you see a line of cars in the right lane, and the left lane is
completely empty, what do you do? Maybe the left lane is closed up ahead, and everyone decided to merge early. Or maybe
the people in the right lane are trying to exit, and there’s a backup on the offramp, one mile ahead. I’m not getting in
that line if that’s the case! One time I was driving and happened upon just such a situation. So I stayed in the left
lane. Someone ahead of me pulled out into the left lane and kept speed with the right lane, blocking me from passing.
I was pissed!</p>

<h3 id="catastrophe">Catastrophe</h3>

<p>It’s worth noting that the 2 second following distance is measured front bumper to front bumper — if you were sitting by
the side of the highway, that’s how you’d count the time between cars going by. But drivers generally like to keep a 2
second following distance between their front bumper and the <em>rear</em> bumper of the car in front of them. The difference
between these is negligible at high speeds, but at a low enough speed, it becomes difficult to maintain a 2 second
following distance from the <em>front</em> bumper of the car in front of you without impinging on the <em>rear</em> bumper of the car
in front of you, especially if said car is more than 0 feet long. So under these circumstances the flow rate of the
highway decreases below 1 car every 2 seconds — maybe to 1 car every 5 seconds. So now you have to wait 5 seconds for
every car in front of you in line.</p>

<p>The situation is modeled pretty well by <a href="http://en.wikipedia.org/wiki/Catastrophe_theory">catastrophe theory</a>,
something I never thought would be useful.</p>

<center><img class="spacer" src="/assets/img/traffic/catastrophe.png" /></center>

<p>At low occupancy (cars per mile), drivers can go as fast as they’d like. As occupancy increases, so does flow rate, even
though speed decreases somewhat due to everyone trying to maintain following distance. At a certain point, when
occupancy becomes high enough, speed dips low enough to where drivers are unable to maintain their minimum following
distance, and — catastrophe! — the flow rate decreases dramatically.</p>

<h3 id="some-code">Some code</h3>

<p>Let’s see how well this model predicts reality. Here’s some code that determines the flow rate and the speed of traffic
as a function of occupancy (cars per km), according to the following-distance model:</p>

<div class="highlight"><pre><code class="scala"><span class="k">def</span> <span class="n">traffic</span><span class="o">(</span><span class="n">carsPerKm</span><span class="k">:</span> <span class="kt">Double</span><span class="o">,</span> <span class="n">carLength</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">5.0</span><span class="o">,</span> <span class="n">secondsBetweenCars</span><span class="k">:</span> <span class="kt">Double</span> <span class="o">=</span> <span class="mf">1.8</span><span class="o">)</span> <span class="k">=</span> <span class="o">{</span>
  <span class="k">val</span> <span class="n">metersPerSecondToKmPerHour</span> <span class="k">=</span> <span class="mf">3600.0</span> <span class="o">/</span> <span class="mf">1000.0</span>
  <span class="k">val</span> <span class="n">metersBetweenCars</span> <span class="k">=</span> <span class="mf">1000.0</span> <span class="o">/</span> <span class="n">carsPerKm</span> <span class="o">-</span> <span class="n">carLength</span>
  <span class="k">val</span> <span class="n">maxSpeed</span> <span class="k">=</span> <span class="n">min</span><span class="o">(</span><span class="mi">120</span><span class="o">,</span> <span class="o">(</span><span class="n">metersBetweenCars</span> <span class="o">/</span> <span class="n">secondsBetweenCars</span><span class="o">)</span> <span class="o">*</span> <span class="n">metersPerSecondToKmPerHour</span><span class="o">)</span>
  <span class="k">val</span> <span class="n">carsPerHour</span> <span class="k">=</span> <span class="n">carsPerKm</span> <span class="o">*</span> <span class="n">maxSpeed</span>
  <span class="o">(</span><span class="n">maxSpeed</span><span class="o">,</span> <span class="n">carsPerHour</span><span class="o">)</span>
<span class="o">}</span></code></pre></div>

<p>Evaluating <code>traffic</code> with values of <code>carsPerKm</code> between 1 and 200 produces the following output:</p>

<center><img class="spacer" src="/assets/img/traffic/model.png" /></center>

<p>Each dot represents a different value of <code>carsPerKm</code> and is plotted as the maximum speed and flow rate it implies.
Below an occupancy of about 16 cars per km, the maximum speed that still allows everyone to keep a 1.8-second following
distance is well above a reasonable speed limit, so I just capped it at 120 kph. Obviously real highway traffic is going
to <a href="http://books.google.com/books?id=4g7f1h4BfYsC&amp;printsec=frontcover#v=onepage&amp;q&amp;f=false">behave in more subtle ways than that</a>.
But it doesn’t matter because the congested part is all I care about, and this model matches observed data pretty well.
Here’s some data from a meta-analysis by the
<a href="http://www.fhwa.dot.gov/publications/research/operations/tft/chap2.pdf">Federal Highway Administration</a>:</p>

<center><img class="spacer" src="/assets/img/traffic/speed_vs_flow.png" /></center>

<p>For another comparison, here’s what the model predicts for flow rate vs. occupancy:</p>

<center><img class="spacer" src="/assets/img/traffic/inverted-v-model.png" /></center>

<p>And here’s the data, from <a href="http://trid.trb.org/view.aspx?id=308654">Freeway Speed-Flow Concentration Relationships</a>:</p>

<center><img class="spacer" src="/assets/img/traffic/inverted-v-actual.png" /></center>

<p>And a quote from the same source:</p>

<blockquote>
  <p>“The inverted-V model implies that drivers maintain a roughly constant average time gap between their front bumper and
the back bumper of the vehicle in front of them, provided their speed is less than some critical value. Once their
speed reaches this critical value (which is as fast as they want to go), they cease to be sensitive to vehicle spacing.”</p>
</blockquote>

<p>Parameter tuning aside, this simple model predicts actual traffic so well that any reasonable discussion of the physics
of traffic jams has to take it into account.</p>

<p><strong>Update</strong>: Lots of great comments in the <a href="https://news.ycombinator.com/item?id=6476836">hacker news thread</a>. One thing
one of the commenters rightly points out is that this model does not account for the variance in flow rates in congested
traffic. I don’t have any data to back this up, but it’s possible that variance in car length (% of trucks on the road)
might account for it. Here’s the same model but with car length ranging between 5 and 8 meters:</p>

<center>
  <img class="spacer" src="/assets/img/traffic/speed-vs-occupancy-2.png" />
  <img class="spacer" src="/assets/img/traffic/flow-vs-occupancy-2.png" />
</center>

<p>But it’s also possible that driver behavior is responsible for it. Pathological driving could certainly create pockets
of low-flow traffic, as human response times and vehicle acceleration times aren’t instantaneous.</p>

<h3 id="anti-traffic">“Anti-traffic”</h3>

<p>Since occupancy determines flow rate, there’s not much benefit to trying to “cancel out” a traffic wave by leaving a ton
of space in front of you. No matter what you do, you’re not going to get to the front of the line before the car in
front of you. Worse, by leaving space in front of you, you’re artificially reducing the occupancy of that part of
the road, but since you haven’t changed the number of cars trying to use the road, <em>this comes at the
expense of increased occupancy somewhere else</em>. Sure, there’s a beautiful line of cars behind you driving at a constant
35 mph, but behind <em>that</em> there’s a ridiculous traffic jam that didn’t need to be there.</p>

<p><strong>Update #2</strong>: Drew R. makes a great point in the comments that there doesn’t always have to be a traffic jam at the back
of that line of cars — specifically, when there is excess capacity in the road behind you, i.e., the flow rate is below
the theoretical maximum and the occupancy is below the critical threshold where people start caring about following
distance. You might know whether such a region exists behind you because you just drove through it. So in that
situation, it is actually beneficial to try to smooth out the traffic wave by driving slower as you approach it.</p>

<h3 id="conclusion">Conclusion</h3>

<p>At the risk of being helpful, here are some things YOU can do that are actually guaranteed to improve commute times for
everyone:</p>

<ol>
  <li>Drive a shorter car.</li>
  <li>Don’t let people merge in front of you, ever.</li>
  <li>Don’t drive during rush hour.</li>
  <li>Move to New York. Seriously, no one owns a car here. It’s great. I don’t even know why I’m writing this.</li>
</ol>

<p>Bye!</p>

    </div>

    

  


  <div style="float: right; margin-top: 5px">
  <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://jliszka.github.io/2013/10/01/how-traffic-actually-works.html" data-text="How traffic actually works" data-via="jliszka">Tweet</a>
  <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
</div>




    
    <div style="clear: both"></div>

    <hr>
    <div class="navigation">
    
      <span class="prev"><a href="/2013/09/24/more-backwards-functions-unevaluating-polynomials.html" title="Unevaluating polynomials">&larr; Unevaluating polynomials</a></span>
    
    
      <span class="next"><a href="/2013/10/10/understanding-a-b-test-analysis.html" title="Understanding A/B test analysis">Understanding A/B test analysis &rarr;</a></span>
    
      <div style="clear: both"></div>
    </div>
    <hr>
    


  <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'jliszka'; // required: replace example with your forum shortname
    
    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>




  </div>

  <div class="span2 sidebar">
    <a href="/"><div id="photo"></div></a>
    <div id="bio">
      <b>Jason Liszka</b><br/>
      <i>Software engineer at Foursquare, CMU alum, Scala fan, new father</i>
    </div>
    <h4>Popular posts</h4>
    <ul>
      <li><a href="/2013/10/01/how-traffic-actually-works.html">How traffic actually works</a></li>
      <li><a href="/2013/08/12/a-frequentist-approach-to-probability.html">A frequentist approach to probability</a></li>
      <li><a href="/2013/10/24/exact-numeric-nth-derivatives.html">Exact numeric nth derivatives</a></li>
      <li><a href="/2013/10/31/infinite-lazy-polynomials.html">Infinite lazy polynomials</a></li>
    </ul>

    <h4>Recent posts</h4>
    <ul>
      
        <li><a href="/2014/06/03/programming-with-futures.html">Programming with futures: patterns and anti-patterns</a></li>
      
        <li><a href="/2014/01/30/good-tech-lead-bad-tech-lead.html">Good Tech Lead, Bad Tech Lead</a></li>
      
        <li><a href="/2013/12/18/bayesian-networks-and-causality.html">Bayesian networks and causality</a></li>
      
        <li><a href="/2013/11/22/unlikely-things-happen-all-the-time.html">Unlikely things happen all the time</a></li>
      
        <li><a href="/2013/11/14/the-foursquare-theorem.html">The Foursquare Theorem</a></li>
      
    </ul>

    <a href="https://twitter.com/jliszka" class="twitter-follow-button" data-show-count="false" data-size="large" data-show-screen-name="false">Follow @jliszka</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  </div>
</div>


      </div>
      <hr>
      <footer>
        <p>&copy; 2014 Jason Liszka
          with help from <a href="http://jekyllbootstrap.com" target="_blank" title="The Definitive Jekyll Blogging Framework">Jekyll Bootstrap</a>
          and <a href="http://twitter.github.com/bootstrap/" target="_blank">Twitter Bootstrap</a>
        </p>
      </footer>

    </div>

    


  <script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-42567355-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>



  </body>
</html>

